# Caliber - Milestone One Prototype

Caliber is a fullstack teaching platform prototype for creating coursework from PDFs, organizing courses, and delivering student-facing assignments with saved progress.

## What This Build Covers

- Authentication and onboarding via Supabase
- Role-aware product experience:
  - Students: `Courses` + profile access
  - Instructors/Admins: full platform access + student-view preview
- Course management with autogenerated join codes
- Student self-enrollment using course codes
- Assignment authoring + student assignment delivery
- Student assignment progress persistence (autosave/resume)
- Instructor student-view preview that does **not** save progress
- Question bank workflow with PDF extraction and manual editing

## Core Use Cases

### 1) Student Flow
- Sign in and complete onboarding (default student role)
- Join a course by code (`<CourseNamePrefix>_<RANDOM6>`)
- Open current assignments in student view
- Work through questions with autosaved progress
- Return later and resume where they left off

### 2) Instructor Flow
- Create and manage courses
- Share course code with students for self-enrollment
- Create assignments and attach questions
- Use Student View to preview assignment UX without mutating student progress data

### 3) Admin Flow
- Manage users and roles
- Review pending instructor requests at top of Users page
- Approve or dismiss instructor access requests

## Main Product Areas

### Authentication + Roles
- Supabase JWT auth across frontend/backend
- Onboarding collects profile data
- Instructor requests are captured as `pending`
- Admin approval toggles users into instructor access

### Courses
- Teachers can create/update/delete courses
- Students can join via course code
- Course code format:
  - `course_name` stripped of spaces/symbols
  - first 16 chars max
  - uppercase
  - `_<6 random letters/numbers>` suffix

### Assignments
- Instructors create assignments per course
- Students see assignments in a student-facing experience
- Assignment progress model tracks per-student state

### Assignment Progress (Resume Support)
- Dedicated `assignment_progress` rows per `(assignment, student)`
- Stores:
  - selected/free-response answers
  - current question index
  - submission status/time
- Sync behavior:
  - Created when assignment is created (for current enrolled students)
  - Created when a new student is added/joins a course
  - Deleted when assignment is deleted

### Question Pipeline
- PDF upload starts background parsing
- Stubbed parser currently extracts mock question chunks
- Question bank supports verification/editing and assignment inclusion

## Architecture Snapshot

- **Frontend**: React + Vite
- **Backend**: FastAPI + SQLModel + Alembic
- **Auth/Storage/DB infra**: Supabase
- **Background work**: FastAPI background tasks for PDF parsing

## Quick Start

### Backend Setup

```bash
cd backend
python -m venv .venv
source .venv/bin/activate  # On Windows: .venv/Scripts/activate
pip install -r requirements.txt
cp .env.example .env
```

Edit your `.env` file and replace the placeholders:
- Replace `your-project-id` in `DATABASE_URL` with your actual Supabase project details
- Replace `your-password` in `DATABASE_URL` with your Supabase database password
- Replace `your-project-id.supabase.co` in `SUPABASE_URL` with your actual Supabase URL
- Replace `your-anon-key-here` in `SUPABASE_ANON_KEY` with your Supabase anon key from step 2 above
- **SUPABASE_JWT_SECRET**: Not needed for modern projects! Only set if you have a legacy project.

**Run database migrations** (first time setup):
```bash
alembic upgrade head
```
If you're getting some weird errors here you need to make sure you're using python v3.12 to create your venv!

See `backend/MIGRATIONS.md` for more details on how to use alembic.

**Start the backend server:**
```bash
uvicorn app.main:app --reload --port 8000
```

The backend will be available at http://localhost:8000

### Frontend Setup

```bash
cd frontend
npm install
cp .env.example .env
```

Edit your frontend `.env` file and replace the placeholders:
- Replace `your-project-id.supabase.co` with your actual Supabase URL
- Replace `your-anon-key-here` with your Supabase anon key

```bash
npm run dev
```

The frontend will be available at http://localhost:5173

## Key API Groups

- `POST /api/upload-pdf` and question endpoints for bank management
- `GET/POST/PUT/DELETE /api/courses` + `POST /api/courses/join`
- `GET/POST/PUT/DELETE /api/assignments`
- `GET/PUT /api/assignments/{id}/progress` for student state
- `GET/PUT /api/users/{id}` for admin role management
- `GET/POST/PUT /api/user*` for current-user profile/onboarding/preferences

## Notes

- Run migrations whenever pulling schema/model changes.
- Current PDF “agent pipeline” is intentionally stubbed and ready to be swapped with a production extraction pipeline.
